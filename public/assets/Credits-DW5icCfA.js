var G=Object.defineProperty,H=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var E=(c,a,t)=>a in c?G(c,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[a]=t,C=(c,a)=>{for(var t in a||(a={}))Y.call(a,t)&&E(c,t,a[t]);if(A)for(var t of A(a))K.call(a,t)&&E(c,t,a[t]);return c},L=(c,a)=>H(c,O(a));var m=(c,a,t)=>new Promise((x,u)=>{var n=l=>{try{y(t.next(l))}catch(d){u(d)}},h=l=>{try{y(t.throw(l))}catch(d){u(d)}},y=l=>l.done?x(l.value):Promise.resolve(l.value).then(n,h);y((t=t.apply(c,a)).next())});import{u as Q,a as q,j as e,L as J}from"./index-D4FcVlNj.js";import{r as i}from"./vendor-W07s9AD9.js";import{m as X,L as N,f as D}from"./ui-DWVAqNqj.js";import"./pdf-C06UDWxx.js";import"./charts-DvSD_8Tn.js";const v=q(),le=()=>{const{user:c}=Q(),[a,t]=i.useState(0),[x,u]=i.useState(!0),[n,h]=i.useState(100),[y,l]=i.useState(!1),[d,k]=i.useState("paypal"),[M,P]=i.useState(!0),[Z,_]=i.useState(null),[T,$]=i.useState([{id:"starter",name:"Starter",price:200,currency:"AED",profileLimit:100,isPopular:!1,isActive:!1},{id:"essential",name:"Essential",price:500,currency:"AED",profileLimit:250,isPopular:!0,isActive:!1},{id:"business",name:"Business",price:1e3,currency:"AED",profileLimit:500,isPopular:!1,isActive:!1},{id:"corporate",name:"Corporate",price:1500,currency:"AED",profileLimit:750,isPopular:!1,isActive:!1}]),[f,w]=i.useState(!1),[g,j]=i.useState(null),[z,V]=i.useState(!1),[B,W]=i.useState(!1),[S,ee]=i.useState(null);i.useEffect(()=>{R(),I();const s=()=>{const r=document.createElement("script");r.src="https://www.paypal.com/sdk/js?client-id=AW_r5mx6frqH8LQR7iXk6x8H9UYQpZ6KtUJlz9paGXi4P5DGQM4E-IZrYHPt4MxlG-jnIm6Pv-9HFf15&currency=AED",r.async=!0,r.onload=()=>{console.log("PayPal SDK loaded"),w(!0)},r.onerror=()=>{console.error("PayPal SDK loading failed"),j("Failed to load PayPal. Please try again later.")},document.body.appendChild(r)};document.querySelector('script[src*="paypal.com/sdk"]')?w(!0):s()},[]),i.useEffect(()=>{if(f&&window.paypal)try{const s=document.getElementById("paypal-button-container");s&&(s.innerHTML="",window.paypal.Buttons({createOrder:(r,o)=>m(void 0,null,function*(){return o.order.create({purchase_units:[{amount:{value:n.toString(),currency_code:"AED"},description:`Purchase ${n} credits for AML Checker`}]})}),onApprove:(r,o)=>m(void 0,null,function*(){l(!0);const p=yield o.order.capture();console.log("Payment successful",p);try{const b=yield fetch(`${v}/credits/purchase`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({amount:n,paymentMethod:"paypal",paymentId:p.id,paymentDetails:p})});if(!b.ok)throw new Error("Failed to process credits purchase");const F=yield b.json();t(F.newBalance),alert(`Successfully purchased ${n} credits!`)}catch(b){console.error("Error processing credit purchase:",b),alert("Payment was successful, but we had trouble adding credits to your account. Please contact support.")}finally{l(!1)}}),onError:r=>{console.error("PayPal error:",r),j("An error occurred with PayPal. Please try again.")}}).render("#paypal-button-container"))}catch(s){console.error("Error rendering PayPal buttons:",s),j("Error setting up PayPal payment. Please try again later.")}},[f,n]);const R=()=>m(void 0,null,function*(){try{u(!0);const s=yield fetch(`${v}/credits`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok)throw new Error(`Failed to fetch credits: ${s.status}`);const r=yield s.json();if(typeof r.credits=="number")t(r.credits);else{console.error("Invalid credits data received:",r);const o=parseInt(r.credits);t(isNaN(o)?0:o)}}catch(s){console.error("Error fetching credits:",s),t(0)}finally{u(!1)}}),I=()=>m(void 0,null,function*(){try{P(!0);const s=yield fetch(`${v}/subscription`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(s.ok){const r=yield s.json();r.subscription&&(_(r.subscription),$(o=>o.map(p=>L(C({},p),{isActive:p.id===r.subscription.id}))))}else console.log("No active subscription or endpoint not available")}catch(s){console.error("Error fetching subscription:",s)}finally{P(!1)}}),U=[{amount:50,price:"100 AED",popular:!1},{amount:100,price:"200 AED",popular:!0},{amount:200,price:"400 AED",popular:!1}];return e.jsx(J,{activeSection:"credits",credits:a,loadingCredits:x,children:e.jsxs("div",{className:"p-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Manage Credits"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(X,{className:"w-6 h-6 mr-3 text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Current Balance"})]}),x?e.jsxs("div",{className:"flex items-center mt-4",children:[e.jsx(N,{className:"w-5 h-5 animate-spin mr-2 text-purple-600"}),e.jsx("span",{children:"Loading credits..."})]}):e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-4xl font-bold text-purple-700",children:a}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Available credits"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-purple-700 mb-2",children:"Subscription Plans"}),e.jsx("p",{className:"text-center text-gray-600 mb-8",children:"Choose the plan that fits your business needs"}),M?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx(N,{className:"w-8 h-8 animate-spin text-purple-600"}),e.jsx("span",{className:"ml-2",children:"Loading subscription details..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:T.map(s=>e.jsxs("div",{className:`relative rounded-lg border ${s.isActive?"border-purple-500 ring-2 ring-purple-300":"border-gray-200"} 
                                        p-6 flex flex-col items-center transition-all hover:shadow-md`,children:[s.isActive&&e.jsxs("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-purple-600 text-xs text-white px-3 py-1 rounded-full flex items-center",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"CURRENT PLAN"]}),s.isPopular&&!s.isActive&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-xs text-yellow-800 px-3 py-1 rounded-full",children:"Most Popular"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:s.name}),e.jsxs("div",{className:"text-5xl font-bold text-purple-600 mb-1",children:[s.price,e.jsxs("span",{className:"text-base font-normal text-gray-500 ml-1",children:[s.currency,"/Year"]})]}),e.jsxs("div",{className:"text-gray-600 my-4",children:["Up to ",s.profileLimit," profiles"]}),e.jsx("div",{className:"text-xs text-gray-500 mb-6",children:"All prices are exclusive of VAT"}),s.isActive&&e.jsxs("div",{className:"flex items-center justify-center text-green-600",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"font-medium",children:"Active"})]})]},s.id))}),S&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 p-4 rounded-md mb-6",children:[e.jsx("p",{className:"font-semibold",children:"Error!"}),e.jsx("p",{children:S})]}),B&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 p-4 rounded-md mb-6",children:[e.jsx("p",{className:"font-semibold",children:"Success!"}),e.jsx("p",{children:"Your subscription has been updated successfully."})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Purchase Credits"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:U.map(s=>e.jsxs("div",{onClick:()=>h(s.amount),className:`border ${n===s.amount?"border-purple-500 bg-purple-50":"border-gray-200"} 
                                    rounded-lg p-4 cursor-pointer relative transition-all hover:shadow-md`,children:[s.popular&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-xs text-yellow-800 px-2 py-0.5 rounded-full",children:"POPULAR"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold",children:[s.amount," Credits"]}),e.jsx("div",{className:"text-2xl font-bold text-purple-600 mt-2",children:s.price})]})]},s.amount))}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"creditAmount",className:"block text-sm font-medium text-gray-700 mb-2",children:"Or enter custom amount:"}),e.jsx("input",{type:"number",id:"creditAmount",value:n,onChange:s=>h(Number(s.target.value)),min:"10",step:"10",className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Payment Method"}),e.jsx("div",{children:e.jsxs("div",{className:`border rounded-lg p-4 flex items-center cursor-pointer transition-all ${d==="paypal"?"border-purple-500 bg-purple-50":"border-gray-200"}`,onClick:()=>k("paypal"),children:[e.jsx("img",{src:"https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_37x23.jpg",alt:"PayPal",className:"h-6 mr-2"}),e.jsx("span",{children:"PayPal"})]})})]}),d==="paypal"&&e.jsxs("div",{className:"mb-4",children:[g&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 p-3 rounded-md mb-4",children:g}),!f&&!g&&e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx(N,{className:"w-8 h-8 animate-spin text-purple-600"}),e.jsx("span",{className:"ml-2",children:"Loading PayPal..."})]}),e.jsx("div",{id:"paypal-button-container",className:"w-full"})]})]})]})})};export{le as default};
//# sourceMappingURL=Credits-DW5icCfA.js.map
